import pandas as pd
from scipy.optimize import curve_fit
import matplotlib.pyplot as plt


data = pd.DataFrame({'year': [1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020],
                     'generate': [8.26192344363636, 9.20460066059596, 12.0178164697778, 15.921260267805, 21.2161740066094, 31.420434564131, 38.3904519471421, 52.3307819867071, 62.9113953016839, 85.1161924282732, 104.083879757882, 132.859216030029, 170.682620580279, 220.600045153997, 276.020526299077, 346.465021938078, 440.385091980306, 530.55442135112, 635.49205101167, 705.805860788812, 831.42968828187, 962.227395409379, 1140.31094904253, 1269.52053571083, 1418.17004626655, 1591.2135122193]})
data['cum_sum'] = data['generate'].cumsum()

# data['Sales1'] = [0, 0.942677216959597, 2.81321580918182, 3.90344379802717, 5.29491373880444, 10.2042605575216, 6.97001738301111, 13.9403300395651, 10.5806133149768, 22.2047971265892, 18.9676873296089, 28.7753362721467, 37.8234045502499, 49.9174245737181, 55.4204811450804, 70.4444956390009, 93.9200700422275, 90.1693293708147, 104.93762966055, 70.3138097771423, 125.623827493058, 130.797707127509, 178.08355363315, 129.209586668305, 148.649510555715, 173.04346595275]
data['Sales'] = [0]+[data['generate'][i+1]-data['generate'][i] for i in range(len(data['generate'][:-1]))]
# def sales(a):
#     sal = []
#     for i in range(len(a[:-1])):
#         if i == 0:
#             sal.append(0)
#         sal.append(a[i+1] - a[i])
#     return sal
# data['Sales2'] = sales(data['generate'])

# Оптимизируя идеальные значения p, q и m, получаем
def c_t(x, p, q, m):
    return (p+(q/m)*(x))*(m-x)
    # return (p*m+(q-p)*(x))-(q/m)*(x**2)
popt, pcov = curve_fit(c_t, data.cum_sum[2:22], data.generate[2:22], maxfev = 50000)
# print(data.cum_sum[0:11])
# print(data.generate[1:12])
# print(popt)
print(round(popt[0],5))
print(round(popt[1],5))
print(round(popt[2],5))
# print(pcov)

data['PrognoseSales'] = [0, 3.4282345646126, 4.27458699002781, 5.32647127731175, 6.63190064224679, 8.24904811406052, 10.2478023188014, 12.7112082188125, 15.7365254525879, 19.4354750100491, 23.933021395096, 29.3637490361247, 35.8645564686632, 43.5620714286883, 52.5530237022281, 62.8760574975612, 74.4745225923841, 87.1521613708994, 100.527730704615, 114.000355383026, 126.743446934276, 137.748050964454, 145.931500020112, 150.309853008129, 150.203828148928, 145.418872979285]
# data['SquareMistake1'] = [0, 6.17799532847185, 15.5782448090793, 28.836427525531, 44.9830832144437, 22.5789424382852, 64.4731176159298, 46.2453528810233, 142.953246479997, 84.4006677378405, 200.288095414495, 217.289133708354, 163.376516454027, 41.3002776448523, 12.6669918203752, 16.0750187495885, 550.132982651383, 700.771116272782, 953.696737097873, 163.956880296669, 193.882907413314, 435.745923430388, 127.182581679565, 96.4862373655924, 129.437458309894, 263.982379040627]
data['PrognoseCumulative'] = [0, 11.690158008249, 15.9647449982768, 21.2912162755885, 27.9231169178353, 36.1721650318958, 46.4199673506972, 59.1311755695098, 74.8677010220976, 94.3031760321467, 118.236197427243, 147.599946463367, 183.464502932031, 227.026574360719, 279.579598062947, 342.455655560508, 416.930178152892, 504.082339523792, 604.610070228406, 718.610425611432, 845.353872545708, 983.101923510162, 1129.03342353027, 1279.3432765384, 1429.54710468733, 1574.96597766662]
data['SquareMistake'] = [0]+[(data['PrognoseCumulative'][i+1]-data['generate'][i+1])**2 for i in range(len(data['generate'][:-1]))]
print(data)


plt.plot(data.year, data.generate, 'b-', label='generate')
plt.plot(data.year, data.PrognoseCumulative, 'r-', label='PrognoseCumulative')
plt.plot(data.year, c_t(data.year, *popt), 'y-')
plt.xlabel('year')
plt.ylabel('generate')
plt.legend()
# plt.show()
